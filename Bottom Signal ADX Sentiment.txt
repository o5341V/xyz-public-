// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Uni_ve12se

//@version=5
indicator("My script",shorttitle="1Uni_veRse", timeframe='')

// Getting inputs
ADXfilter = input(50, title="Defval45, Increase for Higher ADX to filter on lower frames")
Sentimentfilter = input(45, title="Defval30, Decrease for Lower MarketSentiment to filter on lower frames")

wtreshold = input(35, title="Weak Threshold")
streshold = input(40, title="Strong Threshold")

// adx inputs
adxlen = input(20, title="ADX Smoothing")
dilen = input(20, title="DI Length")
dirmov(len) =>
	up = ta.change(high)
	down = -ta.change(low)
	plusDM = na(up) ? na : (up > down and up > 0 ? up : 0)
	minusDM = na(down) ? na : (down > up and down > 0 ? down : 0)
	truerange = ta.rma(ta.tr, len)
	plus = fixnan(100 * ta.rma(plusDM, len) / truerange)
	minus = fixnan(100 * ta.rma(minusDM, len) / truerange)
	[plus, minus]
adx(dilen, adxlen) =>
	[plus, minus] = dirmov(dilen)
	sum = plus + minus
	adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), 1)
sig = adx(dilen, adxlen)

//Sentiment
perioda = 51, periodb= 47, roundingvalue = 4

llow = ta.lowest(low, perioda)

hhigh = ta.highest(high, perioda)

c_ln = close - llow

hn_ln = hhigh - llow

denominator = math.sum(hn_ln, perioda)

numerator = math.sum(c_ln, periodb)

marketsentiment = 100*(numerator/denominator)

up = ta.change(high)
down = -ta.change(low)
trur = ta.rma(ta.tr, adxlen)
plus = fixnan(100 * ta.rma(up > down and up > 0 ? up : 0, dilen) / trur)
minus = fixnan(100 * ta.rma(down > up and down > 0 ? down : 0, dilen) / trur)
sum = plus + minus
adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), 1)

//

Bottomz1= sig > ADXfilter and sig > streshold and plus < minus

Bottomz2 = sig > marketsentiment and marketsentiment < Sentimentfilter

Signalz1 = Bottomz1 and Bottomz2 ? 1 : 0

Signalz2 = Signalz1 < Signalz1[1] ? 1 : 0

plot(Signalz1, title='Plot', style=plot.style_area, color=color.new(#000000, transp=50), linewidth=1)
plot(Signalz2, title='Plot', style=plot.style_line, color=color.new(#000000, transp=0), linewidth=1)