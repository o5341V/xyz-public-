// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© Uni_ve12se
//@version=4
study("Ralph Haller Heikin Ashi Proxy")

HeikGreen = close > open
HeikRed = not HeikGreen

HeikGreenProxy = (high[0] > open) and hl2 > open
HallerGreen = HeikGreenProxy or ((high[0] > high[1]) and (low[0] > low[1]) and (open[0] > open[1]))
HallerRed = not HallerGreen

//HallerGreenPrice = HallerGreen ? close : na
//HeikGreenPrice = HeikGreen ? close : na

barcolor(HallerGreen ? color.lime : na, title="Buy Bar")
barcolor(HallerRed ? color.maroon : na, title="Sell Bar")

lookback = input(1500)

HallerG = HallerGreen ? 1 : 0
HeikG = HeikGreen ? 1 : 0
comparison = HallerGreen == HeikGreen ? 1 : 0
percentage = (sum(HallerG, lookback)/sum(HeikG, lookback))*100

plot(comparison, color=color.white, style=plot.style_histogram, display=display.none)
plot(percentage, color=color.lime, style=plot.style_line)
