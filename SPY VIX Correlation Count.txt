// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© _5341V

//@version=5
indicator('SPY/VIX Correlation Count 2024 v_01', overlay=false)

res = input.string(defval='D', title="TimeFrame 1", options=['01','03','05','10','15','25','30','45','60','90','120','180','240','D', '2D', '3D', '4D', '5D', 'W', 'M'], inline='TF-1', group='TimeFrame Settings')

symbol1 = "CBOE:VIX"
symbol2 = "AMEX:SPY"

Length2 = 3
Length3 = 6
Length4 = 9
Length5 = 12
Length6 = 15
Length7 = 18
Length8 = 21
Length9 = 24
Length10 = 27
Length11 = 30
Length12 = 33
Length13 = 36
Length14 = 39
Length15 = 42
Length16 = 45
Length17 = 48
Length18 = 51
Length19 = 54
Length20 = 57
Length21 = 60
Length22 = 63
Length23 = 66
Length24 = 69
Length25 = 72
Length26 = 75
Length27 = 78
Length28 = 81
Length29 = 84
Length30 = 87
Length31 = 90
Length32 = 93
Length33 = 96
Length34 = 99
Length35 = 102
Length36 = 105
Length37 = 108
Length38 = 111
Length39 = 114
Length40 = 117
Length41 = 120
Length42 = 123

threshhold_Corr = input.float(0.0, step = 0.01)

correlation1_2 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length2) >= threshhold_Corr ? 1 : 0
correlation1_3 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length3) >= threshhold_Corr ? 1 : 0
correlation1_4 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length4) >= threshhold_Corr ? 1 : 0
correlation1_5 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length5) >= threshhold_Corr ? 1 : 0
correlation1_6 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length6) >= threshhold_Corr ? 1 : 0
correlation1_7 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length7) >= threshhold_Corr ? 1 : 0
correlation1_8 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length8) >= threshhold_Corr ? 1 : 0
correlation1_9 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length9) >= threshhold_Corr ? 1 : 0
correlation1_10 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length10) >= threshhold_Corr ? 1 : 0
correlation1_11 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length11) >= threshhold_Corr ? 1 : 0
correlation1_12 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length12) >= threshhold_Corr ? 1 : 0
correlation1_13 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length13) >= threshhold_Corr ? 1 : 0
correlation1_14 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length14) >= threshhold_Corr ? 1 : 0
correlation1_15 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length15) >= threshhold_Corr ? 1 : 0
correlation1_16 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length16) >= threshhold_Corr ? 1 : 0
correlation1_17 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length17) >= threshhold_Corr ? 1 : 0
correlation1_18 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length18) >= threshhold_Corr ? 1 : 0
correlation1_19 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length19) >= threshhold_Corr ? 1 : 0
correlation1_20 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length20) >= threshhold_Corr ? 1 : 0
correlation1_21 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length21) >= threshhold_Corr ? 1 : 0
correlation1_22 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length22) >= threshhold_Corr ? 1 : 0
correlation1_23 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length23) >= threshhold_Corr ? 1 : 0
correlation1_24 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length24) >= threshhold_Corr ? 1 : 0
correlation1_25 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length25) >= threshhold_Corr ? 1 : 0
correlation1_26 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length26) >= threshhold_Corr ? 1 : 0
correlation1_27 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length27) >= threshhold_Corr ? 1 : 0
correlation1_28 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length28) >= threshhold_Corr ? 1 : 0
correlation1_29 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length29) >= threshhold_Corr ? 1 : 0
correlation1_30 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length30) >= threshhold_Corr ? 1 : 0
correlation1_31 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length31) >= threshhold_Corr ? 1 : 0
correlation1_32 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length32) >= threshhold_Corr ? 1 : 0
correlation1_33 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length33) >= threshhold_Corr ? 1 : 0
correlation1_34 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length34) >= threshhold_Corr ? 1 : 0
correlation1_35 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length35) >= threshhold_Corr ? 1 : 0
correlation1_36 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length36) >= threshhold_Corr ? 1 : 0
correlation1_37 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length37) >= threshhold_Corr ? 1 : 0
correlation1_38 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length38) >= threshhold_Corr ? 1 : 0
correlation1_39 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length39) >= threshhold_Corr ? 1 : 0
correlation1_40 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length40) >= threshhold_Corr ? 1 : 0
correlation1_41 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length41) >= threshhold_Corr ? 1 : 0
correlation1_42 = ta.correlation(request.security(symbol1, res, close), request.security(symbol2, res, close), Length42) >= threshhold_Corr ? 1 : 0

Plot1 = (correlation1_2 + correlation1_3 + correlation1_4 + correlation1_5 + correlation1_6 + correlation1_7 + correlation1_8 + correlation1_9 + correlation1_10 +correlation1_11 + correlation1_12 + correlation1_13 + correlation1_14 + correlation1_15 + correlation1_16 + correlation1_17 + correlation1_18 + correlation1_19 + correlation1_20 + correlation1_21 + correlation1_22 + correlation1_23 + correlation1_24 + correlation1_25 + correlation1_26 + correlation1_27 + correlation1_28 + correlation1_29 + correlation1_30 + correlation1_31 + correlation1_32 + correlation1_33 + correlation1_34 + correlation1_35 + correlation1_36 + correlation1_37 + correlation1_38 + correlation1_39 + correlation1_40 + correlation1_41 + correlation1_42) 

plot(series=Plot1, title='Plot', style=plot.style_line, color=color.new(#ff00ff, transp=0), linewidth=1, trackprice = true)

//
len = input.int(5, minval=1, title="Length")
src = input(close, title="Source")
offset = input.int(title="Offset", defval=0, minval=-500, maxval=500, display = display.data_window)
out = ta.ema(src, len)
//

threshhold_Signal =input(15)
color1 =  Plot1 > threshhold_Signal and close >= out ? color.new(#ff00ff, 0) : color.new(#2a2e39, 0)

//color2 = color.from_gradient(Plot1, 0, 40,#2a2e39, #ff00ff)

barcolor(color1)