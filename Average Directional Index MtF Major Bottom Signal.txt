//@version=5
indicator('Average Directional Index MtF', shorttitle='1Uni_veRse', timeframe='', overlay = true)

// Very strong Bottom Signal, this is for VERY strong down moves ie TROUGH of sinewave

// MA

len = input.int(52, minval=1, title="Length")
src = input(close, title="Source")
offset = input.int(title="Offset", defval=0, minval=-500, maxval=500)
out = ta.sma(src, len)

//

streshold = input(10, title='Strong Threshold')

adxlen = input(20, title="ADX Smoothing")
dilen = input(20, title="DI Length")

displayMTF = input(title='Display MTF?', defval=true)

res1 = input.timeframe(title='Multi Timeframe 1:', defval='D')
res2 = input.timeframe(title='Multi Timeframe 2:', defval='2D')
res3 = input.timeframe(title='Multi Timeframe 3:', defval='3D')
res4 = input.timeframe(title='Multi Timeframe 4:', defval='4D')
res5 = input.timeframe(title='Multi Timeframe 5:', defval='5D')

//ta.change(request.security(syminfo.tickerid, timeframe.period, high))
//-ta.change(request.security(syminfo.tickerid, timeframe.period, high))

dirmov(len) =>
	up = ta.change( high)
	down = -ta.change( high)
	plusDM = na(up) ? na : (up > down and up > 0 ? up : 0)
	minusDM = na(down) ? na : (down > up and down > 0 ? down : 0)
	truerange = ta.rma(ta.tr, len)
	plus = fixnan(100 * ta.rma(plusDM, len) / truerange)
	minus = fixnan(100 * ta.rma(minusDM, len) / truerange)
	[plus, minus]
adx(dilen, adxlen) =>
	[plus, minus] = dirmov(dilen)
	sum = plus + minus
	adx = 100 * ta.rma(math.abs(plus - minus) / (sum == 0 ? 1 : sum), 1)
sig = adx(dilen, adxlen)

// 30m

upperThresh1 = input(35)
upperThresh2 = input(45)
upperThresh3 = input(55)

mtfK1 = displayMTF ? request.security(syminfo.tickerid, res1, adx(dilen, adxlen) >= upperThresh1 ? 1 : 0) : na
mtfK11 = displayMTF ? request.security(syminfo.tickerid, res1, adx(dilen, adxlen) >= upperThresh2 ? 1 : 0) : na
mtfK111 = displayMTF ? request.security(syminfo.tickerid, res1, adx(dilen, adxlen) >= upperThresh3 ? 1 : 0) : na

mtfK2 = displayMTF ? request.security(syminfo.tickerid, res2, adx(dilen, adxlen) >= upperThresh1 ? 1 : 0) : na
mtfK22 = displayMTF ? request.security(syminfo.tickerid, res2, adx(dilen, adxlen) >= upperThresh2 ? 1 : 0) : na
mtfK222 = displayMTF ? request.security(syminfo.tickerid, res2, adx(dilen, adxlen) >= upperThresh3 ? 1 : 0) : na

mtfK3 = displayMTF ? request.security(syminfo.tickerid, res3, adx(dilen, adxlen) >= upperThresh1 ? 1 : 0) : na
mtfK33 = displayMTF ? request.security(syminfo.tickerid, res3, adx(dilen, adxlen) >= upperThresh2 ? 1 : 0) : na
mtfK333 = displayMTF ? request.security(syminfo.tickerid, res3, adx(dilen, adxlen) >= upperThresh3 ? 1 : 0) : na

mtfK4 = displayMTF ? request.security(syminfo.tickerid, res4, adx(dilen, adxlen) >= upperThresh1 ? 1 : 0) : na
mtfK44 = displayMTF ? request.security(syminfo.tickerid, res4, adx(dilen, adxlen) >= upperThresh2 ? 1 : 0) : na
mtfK444 = displayMTF ? request.security(syminfo.tickerid, res4, adx(dilen, adxlen) >= upperThresh3 ? 1 : 0) : na

mtfK5 = displayMTF ? request.security(syminfo.tickerid, res5, adx(dilen, adxlen) >= upperThresh1 ? 1 : 0) : na
mtfK55 = displayMTF ? request.security(syminfo.tickerid, res5, adx(dilen, adxlen) >= upperThresh2 ? 1 : 0) : na
mtfK555 = displayMTF ? request.security(syminfo.tickerid, res5, adx(dilen, adxlen) >= upperThresh3 ? 1 : 0) : na

//ALL =  (mtfK1  + mtfK2 + mtfK3 + mtfK4 + mtfK5) + (mtfK11  + mtfK22 + mtfK33 + mtfK44 + mtfK55) + (mtfK111  + mtfK222 + mtfK333 + mtfK444 + mtfK555)
ALL =  (mtfK1  + mtfK2 + mtfK3 + mtfK4 + mtfK5) + (mtfK11  + mtfK22 + mtfK33 + mtfK44 + mtfK55) + (mtfK111  + mtfK222 + mtfK333 + mtfK444 + mtfK555)

up = ta.change(high)
down = -ta.change(low)
trur = ta.rma(ta.tr, adxlen)
plus = fixnan(100 * ta.rma(up > down and up > 0 ? up : 0, dilen) / trur)
minus = fixnan(100 * ta.rma(down > up and down > 0 ? down : 0, dilen) / trur)

ALLcolor = ALL > streshold and plus < minus and close < out ? color.white : color.black

//plot(series=ALL, title="MtF All", color=ALLcolor, style=plot.style_histogram)

barcolor(ALLcolor)

ok = ALL > streshold and plus < minus and close < out

notok = ok == false

bullish2 = ok[1] and notok

plotshape(bullish2, color=color.white, style=shape.triangleup, location=location.bottom, size=size.tiny, textcolor=color.white, transp=10)